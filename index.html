<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <marimo-mode data-mode='edit' hidden></marimo-mode>
    <marimo-version data-version='0.10.9' hidden></marimo-version>
    <marimo-user-config data-config='{"completion": {"activate_on_typing": true, "copilot": false}, "display": {"default_width": "medium", "code_editor_font_size": 16, "cell_output": "above", "dataframes": "rich", "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"preset": "default", "overrides": {}}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "on_cell_change": "autorun"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "package_management": {"manager": "pip"}, "server": {"browser": "default", "follow_symlink": false}}' data-overrides='{}' hidden></marimo-user-config>
    <marimo-app-config data-config='{"width": "medium", "layout_file": "layouts/akatsuki-tutorial.grid.json"}' hidden></marimo-app-config>
    <marimo-server-token data-token='123' hidden></marimo-server-token>
    <title>marimo</title>
    <script type="module" crossorigin src="./assets/index-BWfZxyoz.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-C7Hj70vM.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    <marimo-code hidden="" data-show-code="false">import%20marimo%0A%0A__generated_with%20%3D%20%220.10.9%22%0Aapp%20%3D%20marimo.App(%0A%20%20%20%20width%3D%22medium%22%2C%0A%20%20%20%20layout_file%3D%22layouts%2Fakatsuki-tutorial.grid.json%22%2C%0A)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20from%20pathlib%20import%20Path%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20seaborn%20as%20sns%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20import%20plotly.express%20as%20px%0A%20%20%20%20return%20Path%2C%20mo%2C%20np%2C%20pd%2C%20plt%2C%20px%2C%20sns%0A%0A%0A%40app.cell%0Adef%20_(sns)%3A%0A%20%20%20%20sns.set_context(%22notebook%22%2C%20font_scale%3D1.5%2C%20rc%3D%7B%22lines.linewidth%22%3A%202.5%7D)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%20Getting%20started%20with%20Akatsuki%20data%0A%0A%20%20%20%20%20%20%20%20In%20this%20tutorial%2C%20we%20will%20explore%20the%20Akatsuki%20UVI%20and%20LIR%20data.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Getting%20the%20data%0A%0A%20%20%20%20%20%20%20%20Akatsuki%20is%20JAXA's%20remote%20sensing%20mission%20to%20study%20the%20Venus%20atmosphere.%20The%20data%20are%20served%20at%20%5B**Data%20ARchives%20and%20Transmission%20System%20(DARTS)**%5D(https%3A%2F%2Fdarts.isas.jaxa.jp%2Fen).%0A%0A%20%20%20%20%20%20%20%20Task%3A%20Go%20to%20DARTS%20and%20locate%20akatsuki%20data%20archive.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(ans_darts%2C%20mo)%3A%0A%20%20%20%20_%20%3D%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20mo.md(%22When%20was%20the%20latest%20data%20release%3F%22)%2C%0A%20%20%20%20%20%20%20%20ans_darts%2C%0A%20%20%20%20%20%20%20%20mo.md(%22Correct%20--%20it%20may%20be%20good%20to%20bookmark%20that%20page!%22%20if%20ans_darts.value%20%3D%3D%20%222023-08-01%22%20else%20%22Please%20put%20your%20answer%20in%20the%20textbox%20and%20return.%22)%0A%20%20%20%20%5D)%0A%20%20%20%20_%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22Now%2C%20let's%20go%20specifically%20to%20UVI%20data%20archive.%20You%20will%20mainly%20work%20with%20**Level%203%20map%20data**.%20What%20does%20this%20mean%3F%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%23%23%20Data%20processing%20and%20organization%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.image(%22data-levels.png%22%2C%20width%3D700%2Ccaption%3D%22Fig%201.%20Schematic%20diagram%20of%20the%20science%20data%E2%80%90processing%20pipeline%20developed%20for%20Akatsuki.%20From%20Ogohara%20et%20al.%202017%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22There%20are%20multiple%20processing%20steps%20involved%20in%20going%20from%20telemetry%20data%20to%20science-ready%20images%20in%20a%20convenient%20format%20for%20researchers.%20You%20can%20see%20the%20overall%20flow%20in%20Fig%201%2C%20and%20refer%20to%20Ogohara%20et%20al.%202017%20for%20more%20details.%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(f%22%22%22%23%23%23%20Solving%20geometry%20with%20Limb%20fitting%0A%0A%20%20%20%20%7Bmo.image(%22limb-fitting.png%22%2Cwidth%3D600)%7D%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Task%3A%20let's%20explore%20the%20data%20archive%20for%20UVI%20together%0A%0A%20%20%20%20%20%20%20%20The%20data%20is%20organized%20in%20**volumes**%20(7008-7011%20for%20the%20latest%20version%2C%20v1.1)%2C%20and%20**orbits**.%20The%20orbits%20start%20from%20'c0000'%20for%20up%20to%20orbit%20insertion%20to%20the%20target%20planet%2C%20and%20goes%20r0001%2C%20r0002%2C%20...%20for%20the%20rest%20of%20the%20orbits%20around%20the%20planet.%0A%0A%20%20%20%20%20%20%20%20The%20images%20are%20provided%20either%20in%20FITS%20or%20netCDF%20format.%20I%20recomment%20that%20you%20use%20the%20**netCDF**%20format%20as%20it%20has%20become%20somewhat%20standard%20in%20geoscientific%20data%2C%20and%20works%20well%20with%20%5Bxarray%5D(https%3A%2F%2Fdocs.xarray.dev%2Fen%2Fstable%2F)%2C%20de%20facto%20standard%20tool%20to%20work%20with%20such%20data.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Examples%20images%20and%20maps%0A%0A%20%20%20%20%20%20%20%20There%20are%20two%20different%20kinds%20of%20%22level%203%22%20(calibrated)%20data%20products%20available%3A%20geometry-solved%20images%20(l3bx)%20or%20maps%20(l3b).%20Images%20provide%20the%20radiance%20(suface%20brightness)%20as%20a%20function%20of%20pixel%20coordinates%20whereas%20maps%20sample%20them%20in%20rectangular%20grids%20of%20latitude%20and%20longitude.%0A%0A%20%20%20%20%20%20%20%20Here%2C%20let's%20look%20at%20a%20couple%20of%20examples.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Download%20sample%20data%0A%0A%20%20%20%20%20%20%20%20I%20have%20compiled%20a%20couple%20of%20UVI%20and%20LIR%20images%20from%20orbit%20113%20(r0113)%20and%20packaged%20them%20in%20a%20zip%20file%20for%20this%20workshop.%20Execute%20the%20following%20cell%20to%20download%20example%20data.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Aasync%20def%20_(download_data)%3A%0A%20%20%20%20await%20download_data(0)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%23%23%20Data%20and%20metadata%0A%0A%20%20%20%20%20%20%20%20The%20core%20data%20for%20UVI%20and%20LIR%20instruments%20are%20**single-channel%20images**.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20There%20are%20a%20number%20of%20auxiliary%20%22data%22%20or%20%22attributes%22%20associated%20with%20the%20images.%20For%20example%2C%0A%0A%20%20%20%20%20%20%20%20-%20when%20was%20the%20image%20taken%3F%20(timestamp)%0A%20%20%20%20%20%20%20%20-%20in%20what%20channel%20(wavelength)%20was%20the%20image%20taken%3F%0A%20%20%20%20%20%20%20%20-%20what%20data%20processing%20version%20does%20this%20correspond%20to%3F%0A%20%20%20%20%20%20%20%20-%20was%20the%20solution%20for%20geometry%20(limb%20fitting)%20adequate%3F%0A%20%20%20%20%20%20%20%20-%20what%20was%20the%20distance%20between%20the%20spacecraft%20(%3Dcamera)%20and%20the%20planet%3F%20etc.%0A%0A%0A%20%20%20%20%20%20%20%20These%20are%20often%20called%20the%20**metadata**.%0A%20%20%20%20%20%20%20%20Metadata%20come%20from%20either%20the%20header%20keywords%20or%20%22variables%22.%0A%20%20%20%20%20%20%20%20All%20header%20keywords%20available%20are%20described%20in%20%5Bthe%20official%20documentation%5D(https%3A%2F%2Fdarts.isas.jaxa.jp%2Fmissions%2Fakatsuki%2Fuvi_en.html).%0A%20%20%20%20%20%20%20%20There's%20a%20whole%20slew%20of%20them%20but%20here%20are%20a%20few%20which%20might%20be%20immediately%20useful.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(pd)%3A%0A%20%20%20%20from%20io%20import%20StringIO%0A%0A%20%20%20%20_t%20%3D%20pd.read_csv(StringIO(%22%22%22%0A%20%20%20%20Keyword%7CDescription%7CUnit%0A%20%20%20%20FIT_STAT%7Cellipsefit%20status%3B-2%3A%20OFF%20but%20prescribed%20S_SSCP%5BX%2CY%5D%20was%20used%2C-1%3A%20OFF%2C%200%3A%20NG%2C%201%3A%20OK%2C%202%3A%20OK%20but%20inaccurate.%7C%0A%20%20%20%20S_DISTAV%7CSun-spacecraft%20distance%7Ckm%0A%20%20%20%20S_SOLLON%7Clongitude%20of%20the%20sub-Solar%20point%7Cdeg%0A%20%20%20%20S_SOLLAT%7Clatitude%20of%20the%20sub-Solar%20point%7Cdeg%0A%20%20%20%20S_SSCLON%7Clongitude%20of%20the%20sub-Spacecraft%20point%7Cdeg%0A%20%20%20%20S_SSCLAT%7Clatitude%20of%20the%20sub-Spacecraft%20point%7Cdeg%0A%20%20%20%20D_NPVAZM%7Cazmiuth%20of%20north%20pole%20vector%20in%20degrees.%20This%20angle%20is%20defined%20from%20the%20line%20going%20towards%20the%20left%20to%20be%20positive%20clock-wise.%20Thus%2C%20%2B90%20deg%20is%20north%20pole%20up%20in%20the%20image%20plane%2C%20-90%20deg%20vice%20versa%7Cdeg%0A%20%20%20%20%22%22%22)%2Cdelimiter%3D'%7C')%0A%20%20%20%20_t%0A%20%20%20%20return%20(StringIO%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%23%20Using%20netcdf4%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20from%20netCDF4%20import%20Dataset%0A%20%20%20%20return%20(Dataset%2C)%0A%0A%0A%40app.cell%0Adef%20_(Dataset)%3A%0A%20%20%20%20ds283nc%20%3D%20Dataset(%22data%2Fuvi_20190428_170113_283_l3bx_v21.nc%22)%0A%20%20%20%20ds283nc%0A%20%20%20%20return%20(ds283nc%2C)%0A%0A%0A%40app.cell%0Adef%20_(ds283nc)%3A%0A%20%20%20%20ds283nc.title%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(ds283nc)%3A%0A%20%20%20%20ds283nc.dimensions%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(ds283nc)%3A%0A%20%20%20%20ds283nc.variables%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(ds283nc)%3A%0A%20%20%20%20ds283nc.variables%5B'radiance'%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(ds283nc%2C%20plt)%3A%0A%20%20%20%20plt.pcolormesh(ds283nc%5B'radiance'%5D%5B0%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%23%20Using%20xarray%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20xarray%20as%20xr%0A%20%20%20%20return%20(xr%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20load%20dataset%20using%20xr.load_dataset%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(select_file)%3A%0A%20%20%20%20select_file%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(plot_radiance)%3A%0A%20%20%20%20plot_radiance()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20---%0A%20%20%20%20%20%20%20%20%23%20under%20the%20hood%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20attic_select_file(datastore%2C%20mo)%3A%0A%20%20%20%20select_file%20%3D%20mo.ui.radio(datastore%2C%20value%3D%22data%2Fuvi_20190428_170113_283_l3bx_v21.nc%22%2C%20label%3D%22Select%20file%22)%0A%20%20%20%20return%20(select_file%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20contour_variable%20%3D%20mo.ui.radio(%7Bv%3Ak%20for%20k%2Cv%20in%20dict(%0A%20%20%20%20%20%20%20%20clear%3D%22Clear%20contour%22%2C%0A%20%20%20%20%20%20%20%20inangle%3D'Incidence%20angle'%2C%0A%20%20%20%20%20%20%20%20emangle%3D'Emission%20angle'%2C%0A%20%20%20%20%20%20%20%20phangle%3D'Phase%20angle'%2C%0A%20%20%20%20%20%20%20%20lat%3D'Latitude'%2C%0A%20%20%20%20%20%20%20%20lon%3D'Longitude'%2C%0A%20%20%20%20).items()%7D%2C%20label%3D'Add%20contour%3A'%2C%20value%3D%22Clear%20contour%22)%0A%20%20%20%20mark_geom%20%3D%20mo.ui.checkbox(label%3D'Mark%20geometry')%0A%20%20%20%20mark_limb%20%3D%20mo.ui.checkbox(label%3D'Mark%20limb%20points')%0A%20%20%20%20mo.vstack(%5Bcontour_variable%2Cmark_geom%2Cmark_limb%5D)%0A%20%20%20%20return%20contour_variable%2C%20mark_geom%2C%20mark_limb%0A%0A%0A%40app.cell%0Adef%20attic_plotting(%0A%20%20%20%20contour_variable%2C%0A%20%20%20%20mark_geom%2C%0A%20%20%20%20mark_limb%2C%0A%20%20%20%20np%2C%0A%20%20%20%20plt%2C%0A%20%20%20%20select_file%2C%0A)%3A%0A%20%20%20%20def%20get_center(ds)%3A%0A%20%20%20%20%20%20%20%20cx%2C%20cy%20%3D%20ds%5B%22D_SSCPXF%22%5D.values%2C%20ds%5B%22D_SSCPYF%22%5D.values%0A%20%20%20%20%20%20%20%20return%20(cx%2C%20cy)%0A%0A%20%20%20%20def%20draw_arrow(center%2C%20angle%2C%20length%3D200%2Cax%3DNone)%3A%0A%20%20%20%20%20%20%20%20if%20ax%20is%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20ax%20%3D%20plt.gca()%0A%20%20%20%20%20%20%20%20x%2C%20y%20%3D%20center%0A%20%20%20%20%20%20%20%20dx%2C%20dy%20%3D%20length%20*%20np.cos(np.deg2rad(angle))%2C%20length%20*%20np.sin(np.deg2rad(angle))%0A%20%20%20%20%20%20%20%20return%20ax.arrow(x%2C%20y%2C%20dx%2C%20dy%2C%20head_width%3D20%2C%20head_length%3D20%2C%20fc%3D'w'%2C%20ec%3D'w')%0A%0A%20%20%20%20def%20plot_radiance()%3A%0A%20%20%20%20%20%20%20%20fig%2C%20ax%20%3D%20plt.subplots(figsize%3D(6%2C6)%2Csubplot_kw%3Ddict(aspect%3D'equal'))%0A%20%20%20%20%20%20%20%20ds%20%3D%20select_file.value.isel(time%3D0)%0A%20%20%20%20%20%20%20%20ds%5B'radiance'%5D.plot(ax%3Dax%2Ccmap%3D'cividis'%2Cvmin%3Dds%5B'radiance'%5D.quantile(0.01))%0A%20%20%20%20%20%20%20%20if%20contour_variable.value%20is%20not%20None%20and%20contour_variable.value%20!%3D%20%22clear%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20cs1%20%3D%20ds%5Bcontour_variable.value%5D.plot.contour(ax%3Dax)%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.clabel(cs1)%0A%0A%20%20%20%20%20%20%20%20if%20mark_limb.value%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.plot(ds%5B'lpxf'%5D%2C%20ds%5B'lpyf'%5D%2C%20marker%3D'x'%2C%20ls%3D'none'%2C%20ms%3D1%2C%20color%3D'%23AFDDFF')%0A%20%20%20%20%20%20%20%20if%20mark_geom.value%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20ax.plot(*get_center(ds)%2C%20marker%3D'%2B'%2C%20color%3D'k'%2C%20ms%3D10)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20draw_arrow(get_center(ds)%2C%20180-float(ds%5B'S_NPVAZM'%5D.values)%2C%20ax%3Dax)%0A%20%20%20%20%20%20%20%20return%20fig%0A%20%20%20%20return%20draw_arrow%2C%20get_center%2C%20plot_radiance%0A%0A%0A%40app.cell%0Adef%20attic_darts_ans(mo)%3A%0A%20%20%20%20ans_darts%20%3D%20mo.ui.text(label%3D%22Answer%3A%22%2C%20placeholder%3D%22YYYY-MM-DD%22)%0A%20%20%20%20return%20(ans_darts%2C)%0A%0A%0A%40app.cell%0Adef%20attic_download(Path)%3A%0A%20%20%20%20from%20pyodide.http%20import%20pyfetch%0A%0A%20%20%20%20async%20def%20fetch_binary_file(url)%3A%0A%20%20%20%20%20%20%20%20import%20io%0A%20%20%20%20%20%20%20%20response%20%3D%20await%20pyfetch(url)%0A%20%20%20%20%20%20%20%20if%20response.ok%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20array_buffer%20%3D%20await%20response.buffer()%0A%20%20%20%20%20%20%20%20%20%20%20%20binary_data%20%3D%20io.BytesIO(array_buffer.to_py())%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20binary_data%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20OSError(f%22Failed%20to%20fetch%20file%3A%20%7Bresponse.status%7D%20%7Bresponse.statusText%7D%22)%0A%0A%20%20%20%20async%20def%20download_data(value)%3A%0A%20%20%20%20%20%20%20%20print('in%20download%20func')%0A%20%20%20%20%20%20%20%20from%20zipfile%20import%20ZipFile%0A%0A%20%20%20%20%20%20%20%20if%20value%20%3D%3D%200%20and%20not%20Path(%22data%22).exists()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20import%20requests%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20response%20%3D%20requests.get(%22https%3A%2F%2Fgithub.com%2Fsmoh%2Fnotebook%2Fraw%2Frefs%2Fheads%2Fmaster%2Fdata.zip%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20with%20open('data.zip'%2C%20'wb')%20as%20file%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%20%20%20%20file.write(response.content)%0A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20response%20%3D%20await%20pyfetch(%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%20%20%20%20%22https%3A%2F%2Fraw.githubusercontent.com%2Fsmoh%2Fnotebook%2Fraw%2Frefs%2Fheads%2Fmaster%2Fdata.zip%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20with%20open(%22data.zip%22%2C%20%22wb%22)%20as%20file%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%20%20%20%20file.write(await%20response.bytes())%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20binary_file%20%3D%20await%20fetch_binary_file(%22https%3A%2F%2Fraw.githubusercontent.com%2Fsmoh%2Fnotebook%2Fmaster%2Fdata.zip%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20with%20open('data.zip'%2C%20'wb')%20as%20ff%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ff.write(binary_file.read())%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%22data.zip%20downloaded.%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20assert%20Path(%22data.zip%22).exists()%2C%20%22something%20went%20wrong%3B%20data.zip%20doesn't%20exist!%22%0A%20%20%20%20%20%20%20%20%20%20%20%20with%20ZipFile(%22data.zip%22%2C%20%22r%22)%20as%20zip_ref%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20zip_ref.extractall()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22data%20unpacked%20under%20data%2F%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%22data%20already%20exists%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%201%0A%20%20%20%20return%20download_data%2C%20fetch_binary_file%2C%20pyfetch%0A%0A%0A%40app.cell%0Adef%20attic_check_download(Path)%3A%0A%20%20%20%20def%20check_data_exists()%3A%0A%20%20%20%20%20%20%20%20return%20Path(%22data%22).exists()%0A%20%20%20%20return%20(check_data_exists%2C)%0A%0A%0A%40app.cell%0Adef%20attic_datastore(Path%2C%20xr)%3A%0A%20%20%20%20datastore%20%3D%20%7Bstr(k)%3Axr.load_dataset(k)%20for%20k%20in%20sorted(Path(%22data%22).glob(%22*%22))%7D%0A%20%20%20%20return%20(datastore%2C)%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
  </body>
</html>
